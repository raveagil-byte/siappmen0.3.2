import{d as L,B as M,u as N,r as d,L as R,C as U,K as I,c as k,w as t,b as e,o as _,e as a,q as D,v as F,D as O,s as S,i,y as $,f as b,z as C,E as h,F as x,t as c,G as j,j as q,A as H,I as Q,H as A,M as E,N as z,g as T,h as V,O as G,l as J,J as W,P as X,n as Y,p as Z,Q as ee,k as ae}from"./index-32020cdc.js";import{_ as te}from"./_plugin-vue_export-helper-c27b6911.js";const ne={class:"content-container"},se=L({__name:"KotorPickup",setup(le){const B=M(),g=N(),m=d(null),y=d([]),p=d({}),v=d(""),u=d(!1),r=d(""),w=R(()=>Object.values(p.value).some(l=>l>0));U(async()=>{const l=B.query.unit_id;if(!l){g.push("/home");return}await K(l)});const K=async l=>{try{u.value=!0;const n=await I.get(`/units/${l}`);m.value=n.data.data;const s=await I.get(`/units/${l}/dirty-instruments`);y.value=s.data.data}catch{r.value="Failed to load data"}finally{u.value=!1}},P=async()=>{var n,s;const l=Object.entries(p.value).filter(([o,f])=>f>0).map(([o,f])=>({instrument_id:parseInt(o),quantity:f}));if(l.length===0){r.value="Pilih minimal 1 instrumen";return}try{u.value=!0;const o=await I.post("/transactions/create-kotor",{unit_id:m.value.id,items:l,notes:v.value||null});await(await ee.create({header:"Sukses",message:"Transaksi kotor berhasil dibuat. QR Code telah digenerate.",buttons:[{text:"Lihat QR",handler:()=>{g.push(`/transaction-qr/${o.data.data.transaction.id}`)}}]})).present()}catch(o){r.value=((s=(n=o.response)==null?void 0:n.data)==null?void 0:s.message)||"Failed to create transaction"}finally{u.value=!1}};return(l,n)=>(_(),k(e(Z),null,{default:t(()=>[a(e($),null,{default:t(()=>[a(e(D),null,{default:t(()=>[a(e(F),{slot:"start"},{default:t(()=>[a(e(O),{"default-href":"/home"})]),_:1}),a(e(S),null,{default:t(()=>[...n[2]||(n[2]=[i("Pengambilan Kotor",-1)])]),_:1})]),_:1})]),_:1}),a(e(Y),{fullscreen:!0},{default:t(()=>[b("div",ne,[m.value?(_(),k(e(C),{key:0},{default:t(()=>[a(e(h),null,{default:t(()=>[a(e(x),null,{default:t(()=>[i(c(m.value.name),1)]),_:1}),a(e(j),null,{default:t(()=>[i(c(m.value.location),1)]),_:1})]),_:1})]),_:1})):q("",!0),a(e(C),null,{default:t(()=>[a(e(h),null,{default:t(()=>[a(e(x),null,{default:t(()=>[...n[3]||(n[3]=[i("Instrumen Kotor di Unit",-1)])]),_:1})]),_:1}),a(e(H),null,{default:t(()=>[a(e(Q),null,{default:t(()=>[(_(!0),A(z,null,E(y.value,s=>(_(),k(e(T),{key:s.id},{default:t(()=>[a(e(V),null,{default:t(()=>[b("h3",null,c(s.name),1),b("p",null,c(s.code)+" - Kotor: "+c(s.dirty_stock),1)]),_:2},1024),a(e(ae),{modelValue:p.value[s.id],"onUpdate:modelValue":o=>p.value[s.id]=o,modelModifiers:{number:!0},type:"number",min:0,max:s.dirty_stock,placeholder:"0"},null,8,["modelValue","onUpdate:modelValue","max"])]),_:2},1024))),128))]),_:1}),a(e(T),null,{default:t(()=>[a(e(V),{position:"stacked"},{default:t(()=>[...n[4]||(n[4]=[i("Catatan (Opsional)",-1)])]),_:1}),a(e(G),{modelValue:v.value,"onUpdate:modelValue":n[0]||(n[0]=s=>v.value=s),placeholder:"Tambahkan catatan..."},null,8,["modelValue"])]),_:1}),a(e(J),{expand:"block",color:"warning",onClick:P,disabled:!w.value||u.value,class:"submit-button"},{default:t(()=>[i(c(u.value?"Membuat Transaksi...":"Buat Transaksi Kotor"),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),a(e(W),{"is-open":!!r.value,message:r.value,duration:3e3,color:"danger",onDidDismiss:n[1]||(n[1]=s=>r.value="")},null,8,["is-open","message"]),a(e(X),{"is-open":u.value,message:"Memproses..."},null,8,["is-open"])]),_:1})]),_:1}))}});const re=te(se,[["__scopeId","data-v-1bc78773"]]);export{re as default};
