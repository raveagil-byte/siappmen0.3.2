import{d as L,B as M,u as N,r as i,L as R,C as F,K as I,c as b,w as t,b as e,o as _,e as a,q as O,v as P,D as U,s as j,i as d,y as q,f as g,z as y,E as C,F as T,t as c,G as H,j as Q,A as $,I as A,H as E,M as z,N as G,g as x,h as V,O as J,l as K,J as W,P as X,n as Y,p as Z,Q as ee,k as ae}from"./index-32020cdc.js";import{_ as te}from"./_plugin-vue_export-helper-c27b6911.js";const le={class:"content-container"},se=L({__name:"DistribusiSteril",setup(ne){const B=M(),k=N(),m=i(null),h=i([]),f=i({}),v=i(""),u=i(!1),r=i(""),w=R(()=>Object.values(f.value).some(n=>n>0));F(async()=>{const n=B.query.unit_id;if(!n){k.push("/home");return}await D(n)});const D=async n=>{try{u.value=!0;const l=await I.get(`/units/${n}`);m.value=l.data.data;const s=await I.get("/instruments",{params:{available_for_steril:!0}});h.value=s.data.data}catch{r.value="Failed to load data"}finally{u.value=!1}},S=async()=>{var l,s;const n=Object.entries(f.value).filter(([o,p])=>p>0).map(([o,p])=>({instrument_id:parseInt(o),quantity:p}));if(n.length===0){r.value="Pilih minimal 1 instrumen";return}try{u.value=!0;const o=await I.post("/transactions/create-steril",{unit_id:m.value.id,items:n,notes:v.value||null});await(await ee.create({header:"Sukses",message:"Transaksi berhasil dibuat. QR Code telah digenerate.",buttons:[{text:"Lihat QR",handler:()=>{k.push(`/transaction-qr/${o.data.data.transaction.id}`)}}]})).present()}catch(o){r.value=((s=(l=o.response)==null?void 0:l.data)==null?void 0:s.message)||"Failed to create transaction"}finally{u.value=!1}};return(n,l)=>(_(),b(e(Z),null,{default:t(()=>[a(e(q),null,{default:t(()=>[a(e(O),null,{default:t(()=>[a(e(P),{slot:"start"},{default:t(()=>[a(e(U),{"default-href":"/home"})]),_:1}),a(e(j),null,{default:t(()=>[...l[2]||(l[2]=[d("Distribusi Steril",-1)])]),_:1})]),_:1})]),_:1}),a(e(Y),{fullscreen:!0},{default:t(()=>[g("div",le,[m.value?(_(),b(e(y),{key:0},{default:t(()=>[a(e(C),null,{default:t(()=>[a(e(T),null,{default:t(()=>[d(c(m.value.name),1)]),_:1}),a(e(H),null,{default:t(()=>[d(c(m.value.location),1)]),_:1})]),_:1})]),_:1})):Q("",!0),a(e(y),null,{default:t(()=>[a(e(C),null,{default:t(()=>[a(e(T),null,{default:t(()=>[...l[3]||(l[3]=[d("Pilih Instrumen",-1)])]),_:1})]),_:1}),a(e($),null,{default:t(()=>[a(e(A),null,{default:t(()=>[(_(!0),E(G,null,z(h.value,s=>(_(),b(e(x),{key:s.id},{default:t(()=>[a(e(V),null,{default:t(()=>[g("h3",null,c(s.name),1),g("p",null,c(s.code)+" - Tersedia: "+c(s.available_stock),1)]),_:2},1024),a(e(ae),{modelValue:f.value[s.id],"onUpdate:modelValue":o=>f.value[s.id]=o,modelModifiers:{number:!0},type:"number",min:0,max:s.available_stock,placeholder:"0"},null,8,["modelValue","onUpdate:modelValue","max"])]),_:2},1024))),128))]),_:1}),a(e(x),null,{default:t(()=>[a(e(V),{position:"stacked"},{default:t(()=>[...l[4]||(l[4]=[d("Catatan (Opsional)",-1)])]),_:1}),a(e(J),{modelValue:v.value,"onUpdate:modelValue":l[0]||(l[0]=s=>v.value=s),placeholder:"Tambahkan catatan..."},null,8,["modelValue"])]),_:1}),a(e(K),{expand:"block",onClick:S,disabled:!w.value||u.value,class:"submit-button"},{default:t(()=>[d(c(u.value?"Membuat Transaksi...":"Buat Transaksi"),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),a(e(W),{"is-open":!!r.value,message:r.value,duration:3e3,color:"danger",onDidDismiss:l[1]||(l[1]=s=>r.value="")},null,8,["is-open","message"]),a(e(X),{"is-open":u.value,message:"Memproses..."},null,8,["is-open"])]),_:1})]),_:1}))}});const re=te(se,[["__scopeId","data-v-5348fc9c"]]);export{re as default};
